<div class="container py-1">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-12 col-md-12 col-sm-12">
      <div class="card p-2">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h3 class="text-center mb-2 fw-bold text-dark">
              {{ isEditMode ? "โ๏ธ ุชุนุฏูู ุณูุงุฑุฉ" : "๐ ุชุณุฌูู ุณูุงุฑุฉ" }}
            </h3>
          </div>
          <div>
            <button class="btn" (click)="closeForm.emit()">โฌ๏ธ ุบูู</button>
          </div>
        </div>

        <form
          [formGroup]="carForm"
          (ngSubmit)="onSubmit()"
          novalidate
          dir="rtl"
        >
          <!-- ุตูุฑุฉ ุงูุณูุงุฑุฉ -->
          <!-- <div class="col-md-4 text-center my-2" style="width: 100px">
            <div class="avatar-upload">
              <img
                [src]="carImagesPreview || defaultCarImage"
                alt="ุตูุฑุฉ ุงูุณูุงุฑุฉ"
                class="avatar-img"
              />
              <label for="carImageInput" class="edit-icon">โ๏ธ</label>
              <input
                type="file"
                id="carImageInput"
                accept="image/*"
                (change)="onFilesSelected($event)"
              />
              
            </div>
          </div> -->

          <!-- ุตูุฑ ุงูุณูุงุฑุฉ -->
          <div class="col-12 text-center my-2">
            <label class="form-label d-block">๐ธ ุตูุฑ ุงูุณูุงุฑุฉ</label>

            <!-- ุฑูุน ุงูุตูุฑ -->
            <input
              type="file"
              accept="image/*"
              multiple
              (change)="onFileSelected($event)"
              class="form-control mb-2"
            />

            <!-- ุนุฑุถ ุงูุตูุฑ -->
            <div class="d-flex gap-2 flex-wrap mt-2">
              <div
                *ngFor="let img of carImagesPreview; let i = index"
                class="position-relative"
              >
                <img
                  [src]="img || defaultCarImage"
                  [ngStyle]="{
                    width: i === 0 ? '150px' : '100px',
                    height: i === 0 ? '150px' : '100px',
                    border: i === 0 ? '3px solid green' : '2px solid #ccc',
                    objectFit: 'cover'
                  }"
                  class="rounded"
                />
                <span
                  class="position-absolute top-0 end-0 bg-danger text-white rounded-circle px-1"
                  style="cursor: pointer"
                  (click)="removeImage(i)"
                >
                  โ
                </span>
                <span
                  *ngIf="i === 0"
                  class="position-absolute bottom-0 start-0 bg-success text-white px-1 rounded-pill"
                  style="font-size: 10px"
                >
                  ุฑุฆูุณูุฉ
                </span>
              </div>
            </div>
          </div>

          <div class="row g-3 text-end">
            <!-- ุงูููุฏูู -->
            <div class="col-md-4">
              <label class="form-label">ุงูููุฏูู</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="Model"
              />
            </div>

            <!-- ููุน ุงูุณูุงุฑุฉ -->
            <div class="col-md-4">
              <label class="form-label">ููุน ุงูุณูุงุฑุฉ</label>
              <mat-form-field appearance="outline" class="w-100 custom-outline">
                <mat-select formControlName="Type">
                  <mat-option
                    *ngFor="let carType of carTypes"
                    [value]="carType"
                  >
                    {{ carType }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- ุงููุงุฑูุฉ -->
            <div class="col-md-4">
              <label class="form-label">ุงููุงุฑูุฉ</label>
              <mat-form-field appearance="outline" class="w-100 custom-outline">
                <mat-select
                  formControlName="BrandId"
                  (selectionChange)="onBrandChange($event.value)"
                >
                  <mat-option *ngFor="let brand of brands" [value]="brand.Id">
                    {{ brand.BrandName }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- ุงูููู -->
            <div class="col-md-4">
              <label class="form-label">ุงูููู</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="Color"
              />
            </div>

            <!-- ุนุฏุฏ ุงููููููุชุฑุงุช -->
            <div class="col-md-4">
              <label class="form-label">ุนุฏุฏ ุงููููููุชุฑุงุช</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="Kilometers"
              />
            </div>

            <!-- ูุงูู ุงูุญุฑูุฉ -->
            <div class="col-md-4">
              <label class="form-label">ูุงูู ุงูุญุฑูุฉ</label>
              <mat-form-field appearance="outline" class="w-100 custom-outline">
                <mat-select formControlName="Transmission">
                  <mat-option
                    *ngFor="let transmissionType of transmissionTypes"
                    [value]="transmissionType"
                  >
                    {{ transmissionType }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- ุงูุณุนุฑ -->
            <div class="col-md-4">
              <label class="form-label">ุงูุณุนุฑ</label>
              <input
                type="number"
                class="form-control custom-input"
                formControlName="Price"
              />
            </div>

            <!-- ุณูุฉ ุงูุตูุน -->
            <div class="col-md-4">
              <label class="form-label">ุณูุฉ ุงูุตูุน</label>
              <input
                type="number"
                class="form-control custom-input"
                formControlName="YearOfManufacture"
              />
            </div>

            <!-- ููุน ุงููุญุฑู -->
            <div class="col-md-4">
              <label class="form-label">ููุน ุงููุญุฑู</label>
              <mat-form-field appearance="outline" class="w-100 custom-outline">
                <mat-select formControlName="EngineType">
                  <mat-option
                    *ngFor="let engineType of engineTypes"
                    [value]="engineType"
                  >
                    {{ engineType }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- ููุฉ ุงูุญุตุงู -->
            <div class="col-md-4">
              <label class="form-label">ููุฉ ุงูุญุตุงู</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="HorsePower"
              />
            </div>

            <!-- ุนุฏุฏ ุงููุณุงุฆุฏ ุงูููุงุฆูุฉ -->
            <div class="col-md-4">
              <label class="form-label">ุนุฏุฏ ุงููุณุงุฆุฏ ุงูููุงุฆูุฉ</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="AirBagCount"
              />
            </div>

            <!-- ุณุนุฉ ุงูุดูุทุฉ -->
            <div class="col-md-4">
              <label class="form-label">ุณุนุฉ ุงูุดูุทุฉ</label>
              <input
                type="text"
                class="form-control custom-input"
                formControlName="BagCapacity"
              />
            </div>

            <!-- ุงูุญุงูุฉ -->
            <div class="col-md-4">
              <label class="form-label">ุงูุญุงูุฉ</label>
              <mat-form-field appearance="outline" class="w-100 custom-outline">
                <mat-select formControlName="Condition">
                  <mat-option value="New">ุฌุฏูุฏุฉ</mat-option>
                  <mat-option value="Used">ูุณุชุนููุฉ</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <!-- โ ุงููููุฒุงุช -->
            <div class="col-12 mt-3">
              <label class="form-label d-block mb-2 fw-bold">ุงููููุฒุงุช</label>
              <div class="d-flex flex-wrap gap-3">
                <div *ngFor="let feature of features">
                  <!-- ุฎุงุตูุฉ "ุฅุนุฑุถูุง ููุจูุน" ูุน Confirm ูุดูู ูุฎุชูู -->
                  <ng-container *ngIf="feature.key === 'IsForSale'">
                    <input
                      type="checkbox"
                      class="form-check-input ms-1"
                      [id]="feature.key"
                      [checked]="carForm.get('IsForSale')?.value"
                      (click)="confirmIsForSale($event)"
                    />
                    <label
                      [for]="feature.key"
                      class="badge bg-warning text-dark px-2 py-2 rounded-pill"
                    >
                      {{ feature.label }}
                    </label>
                  </ng-container>

                  <!-- ุจุงูู ุงูููุชุดุฑุฒ ุนุงุฏูุฉ -->
                  <ng-container *ngIf="feature.key !== 'IsForSale'">
                    <input
                      type="checkbox"
                      class="form-check-input ms-1"
                      [formControlName]="feature.key"
                      [id]="feature.key"
                    />
                    <label [for]="feature.key">{{ feature.label }}</label>
                  </ng-container>
                </div>
              </div>
            </div>

            <!-- ุฒุฑ ุงูุญูุธ -->
            <div class="col-12 text-center mt-3">
              <button
                class="btn btn-warning btn-lg py-0"
                [disabled]="isSubmitting"
              >
                {{ isEditMode ? "๐ ุชุนุฏูู" : "โ ุชุณุฌูู" }}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<p-confirmDialog></p-confirmDialog>
