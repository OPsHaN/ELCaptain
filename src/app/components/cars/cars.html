<!-- âœ… Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<div
  class="toolbar d-flex flex-wrap justify-content-end gap-3 position-relative mt-2"
>
  <div class="position-relative">
    <button class="btn btn-outline-warning" (click)="toggleRegisterForm()">
      â• ØªØ³Ø¬ÙŠÙ„ Ø¹Ø±Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
    </button>
    <div class="arrow-wrapper" *ngIf="showRegisterForm">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>
</div>

<!-- âœ… ÙÙˆØ±Ù… ØªØ³Ø¬ÙŠÙ„ / ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
<div class="table-container mt-0" *ngIf="showRegisterForm" dir="rtl">
  <app-car-register
    *ngIf="showRegisterForm"
    [car]="selectedCar"
    (closeForm)="toggleRegisterForm()"
    [isEditMode]="isEditMode"
  ></app-car-register>
</div>

<!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
<!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
<div class="car-wrap" *ngIf="!showRegisterForm">
  <div class="cards-grid" dir="rtl">
    <div
      class="card car-card dome-card text-center position-relative"
      *ngFor="let car of cars; trackBy: trackById"
      (click)="viewCar(car)"
      role="button"
      aria-label="Open car {{ car.Brand.BrandName }} {{ car.Model }}"
    >
      <!-- âœ… Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£Ø¹Ù„Ù‰ ÙŠÙ…ÙŠÙ† Ø§Ù„ØµÙˆØ±Ø© -->
      <span
        class="status-badge"
        [ngClass]="{ online: car.IsForSale, offline: !car.IsForSale }"
      >
        {{ car.IsForSale ? "Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø¨ÙŠØ¹" : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©" }}
      </span>

      <!-- âœ… ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <img
        [src]="car.Images.length ? car.Images[0].Img : defaultCarImage"
        class="card-img-top car-img"
        alt="{{ car.Brand.BrandName }}"
      />

      <div class="card-body p-0">
        <!-- Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ -->
        <h5 class="card-title fw-bold mb-2">
          {{ car.Model }}
        </h5>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª -->
        <table class="table table-borderless specs-table mb-3">
          <tbody>
            <tr>
              <td class="fw-bold">Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯</td>
              <td
                class="d-flex align-items-center gap-2 justify-content-center"
              >
                <img
                  [src]="car.Brand.Img || defaultCarImage"
                  alt="{{ car.Brand.CountryName }}"
                  class="country-flag rounded"
                />
                {{ car.Brand.BrandName }}
              </td>
            </tr>
            <tr>
              <td class="fw-bold">Ø§Ù„Ù„ÙˆÙ†</td>
              <td
                class="d-flex align-items-center justify-content-center gap-2"
              >
                <span
                  class="color-box"
                  [ngStyle]="{ backgroundColor: getColorCode(car.Color) }"
                ></span>
                {{ car.Color }}
              </td>
            </tr>
            <tr>
              <td class="fw-bold">Ø§Ù„Ø¯ÙˆÙ„Ø©</td>
              <td
                class="d-flex align-items-center gap-2 justify-content-center"
              >
                <img
                  [src]="car.Brand.Country.Img || defaultCarImage"
                  alt="{{ car.Brand.Country.CountryName }}"
                  class="country-flag rounded"
                />
                {{ car.Brand.Country.CountryName }}
              </td>
            </tr>
            <!-- <tr>
              <td class="fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©</td>
              <td [ngClass]="{ 'text-success': car.IsForSale, 'text-danger': !car.IsForSale }">
                {{ car.IsForSale ? 'Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø¨ÙŠØ¹' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©' }}
              </td>
            </tr> -->
          </tbody>
        </table>
      </div>

      <!-- Ø§Ù„Ø³Ø¹Ø± -->
      <div class="car-price-box">
        {{ car.Price | currency : "EGP" }}
      </div>

      <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
      <div class="card-actions d-flex justify-content-center gap-2 p-2">
        <button
          class="btn btn-sm btn-success rounded-circle"
          (click)="editCar(car); $event.stopPropagation()"
        >
          âœï¸
        </button>
        <button
          class="btn btn-sm btn-danger rounded-circle"
          (click)="deleteCar(car); $event.stopPropagation()"
        >
          ğŸ—‘
        </button>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Dialog Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø¹ Carousel -->
<!-- âœ… Dialog Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø¹ Carousel -->
<p-dialog
  header="ğŸš— Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©"
  [(visible)]="showCarDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '500px' }"
  [baseZIndex]="10000"
  dir="rtl"
>
  <ng-container *ngIf="selectedCar">
    <div class="text-center p-2">
      <!-- âœ… Carousel Ù„Ù„ØµÙˆØ± -->
      <p-carousel
        [value]="
          selectedCar.Images.length ? selectedCar.Images : [defaultCarImage]
        "
        [numVisible]="1"
        [numScroll]="1"
        [circular]="true"
        [autoplayInterval]="3000"
        [showIndicators]="false"
        [showNavigators]="true"
      >
        <ng-template pTemplate="item" let-image>
          <div class="car-image-wrapper">
            <img
              [src]="image.Img ? image.Img : image"
              class="car-image rounded mb-3"
              alt="Car image"
            />
          </div>
        </ng-template>
      </p-carousel>

      <!-- ğŸ§¾ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <h4 class="fw-bold mb-3">
        {{ selectedCar.Brand.BrandName }} - {{ selectedCar.Model }}
      </h4>

      <table class="table table-borderless specs-table mb-3 text-center">
        <tbody>
          <tr>
            <td class="fw-bold">Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯</td>
            <td
              class="d-flex align-items-center gap-2 justify-content-center"
            >
              <img
                [src]="selectedCar.Brand.Img || defaultCarImage"
                alt="{{ selectedCar.Brand.BrandName }}"
                class="country-flag rounded"
              />
              {{ selectedCar.Brand.BrandName }}
            </td>
          </tr>
          <tr>
            <td class="fw-bold">Ø§Ù„Ù„ÙˆÙ†</td>
            <td
              class="d-flex align-items-center justify-content-center gap-2"
            >
              <span
                class="color-box"
                [ngStyle]="{ backgroundColor: getColorCode(selectedCar.Color) }"
              ></span>
              {{ selectedCar.Color }}
            </td>
          </tr>
          <tr>
            <td class="fw-bold">Ø§Ù„Ø¯ÙˆÙ„Ø©</td>
            <td
              class="d-flex align-items-center gap-2 justify-content-center"
            >
              <img
                [src]="selectedCar.Brand.Country.Img || defaultCarImage"
                alt="{{ selectedCar.Brand.Country.CountryName }}"
                class="country-flag rounded"
              />
              {{ selectedCar.Brand.Country.CountryName }}
            </td>
          </tr>
          <tr>
            <td class="fw-bold">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹</td>
            <td>{{ selectedCar.YearOfManufacture }}</td>
          </tr>
          <tr>
            <td class="fw-bold">Ø§Ù„ÙƒÙŠÙ„Ùˆ Ù…ØªØ±</td>
            <td>{{ selectedCar.Kilometers }}</td>
          </tr>
          <tr>
            <td class="fw-bold">Ø§Ù„Ø³Ø¹Ø±</td>
            <td>{{ selectedCar.Price | currency : 'EGP' }}</td>
          </tr>
          <tr>
            <td class="fw-bold"> Ø§Ù„Ø­Ø§Ù„Ø©</td>
            <td [ngClass]="{ 'text-success': selectedCar.IsForSale, 'text-danger': !selectedCar.IsForSale }">
              {{ selectedCar.IsForSale ? 'Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø¨ÙŠØ¹' : 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©' }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</p-dialog>

