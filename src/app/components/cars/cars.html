<!-- ✅ شريط الأزرار -->
<div
  class="toolbar d-flex flex-wrap justify-content-end gap-3 position-relative mt-2"
>
  <div class="position-relative">
    <button class="btn btn-outline-warning" (click)="toggleRegisterForm()">
      ➕ تسجيل عربية جديدة
    </button>
    <div class="arrow-wrapper" *ngIf="showRegisterForm">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>
</div>

<!-- ✅ فورم تسجيل / تعديل السيارة -->
<div class="table-container mt-0" *ngIf="showRegisterForm" dir="rtl">
  <app-car-register
    *ngIf="showRegisterForm"
    [car]="selectedCar"
    (closeForm)="toggleRegisterForm()"
    [isEditMode]="isEditMode"
  ></app-car-register>
</div>

<!-- ✅ جدول السيارات -->
<div class="car-wrap" *ngIf="!showRegisterForm">
  <div class="cards-grid" dir="rtl">
    <div
      class="card car-card"
      *ngFor="let car of cars; trackBy: trackById"
      (click)="viewCar(car)"
      role="button"
      aria-label="Open car {{ car.Brand.BrandName }} {{ car.Model }}"
    >
      <!-- صورة السيارة -->
      <div class="card-media">
        <img
          [src]="car.Images.length ? car.Images[0].Img : defaultCarImage"
          alt="{{ car.Brand.BrandName }}"
          loading="lazy"
        />
      </div>

      <!-- حالة السيارة -->
      <span
        class="status-badge"
        [ngClass]="{ online: car.IsForSale, offline: !car.IsForSale }"
      >
        {{ car.IsForSale ? "معروضة للبيع" : "غير معروضة" }}
      </span>

      <div class="card-body text-center">

        <!-- شعار البراند -->
        <div class="brand-logo-wrapper mb-2">
          <img
            [src]="car.Brand.Img || defaultCarImage"
            alt="{{ car.Brand.BrandName }}"
            class="brand-logo rounded-circle"
            width="50"
            height="50"
          />
        </div>

        <!-- تفاصيل السيارة -->
        <h3 class="car-model">{{ car.Model }}</h3>

        <p class="car-info mb-1">
          النوع: {{ car.Type }} | اللون: {{ car.Color }}
        </p>

        <!-- عرض علم الدولة -->
        <p class="car-country d-flex align-items-center justify-content-center gap-1 mb-1">
          <img
            [src]="car.Brand.Country.Img || defaultCarImage"
            alt="{{ car.Brand.Country.CountryName }}"
            class="country-flag rounded-circle"
            width="50"
            height="50"
          />
          {{ car.Brand.Country.CountryName }}
        </p>

        <p class="car-year mb-1">سنة الصنع: {{ car.YearOfManufacture }}</p>
        <p class="car-km mb-1">الكيلو متر: {{ car.Kilometers }}</p>

        <!-- السعر -->
        <p class="car-price fw-bold text-primary mb-2">
          السعر: {{ car.Price | currency : "EGP" }}
        </p>

        <!-- أزرار الإجراءات -->
        <div class="card-actions d-flex justify-content-center gap-2 mt-2">
          <button
            class="btn btn-sm btn-success rounded-circle"
            (click)="editCar(car); $event.stopPropagation()"
          >
            ✏️
          </button>
          <button
            class="btn btn-sm btn-danger rounded-circle"
            (click)="deleteCar(car); $event.stopPropagation()"
          >
            🗑
          </button>
        </div>

      </div>
    </div>
  


<!-- ✅ Dialog عرض بيانات السيارة مع Carousel -->
<p-dialog
  header="🚗 بيانات السيارة"
  [(visible)]="showCarDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '500px' }"
  [baseZIndex]="10000"
  dir="rtl"
>
  <ng-container *ngIf="selectedCar">
    <div class="text-center p-2">

      <!-- ✅ Carousel للصور -->
      <p-carousel 
        [value]="selectedCar.Images.length ? selectedCar.Images : [defaultCarImage]"
        [numVisible]="1" 
        [numScroll]="1"
        [circular]="true"
        [autoplayInterval]="3000"
        [showIndicators]="true"
        [showNavigators]="true"
      >
        <ng-template pTemplate="item" let-image>
          <img 
            [src]="image.Img ? image.Img : image" 
            class="rounded mb-3"
            width="200"
            height="150"
            alt="Car image"
          />
        </ng-template>
      </p-carousel>

      <!-- بيانات السيارة -->
      <h4>{{ selectedCar.Brand.BrandName }} - {{ selectedCar.Model }}</h4>
      <p>{{ selectedCar.Type }} | {{ selectedCar.Color }}</p>

      <hr />

      <p><strong>🏭 الفرع / البلد:</strong> {{ selectedCar.Brand.BrandName }} - {{ selectedCar.Brand.Country.CountryName }}</p>
      <p><strong>📅 سنة الصنع:</strong> {{ selectedCar.YearOfManufacture }}</p>
      <p><strong>🛣 الكيلو متر:</strong> {{ selectedCar.Kilometers }}</p>
      <p><strong>💰 السعر:</strong> {{ selectedCar.Price | currency : "EGP" }}</p>
      <p><strong>📡 الحالة:</strong> {{ selectedCar.IsForSale ? "معروضة للبيع" : "غير معروضة" }}</p>

    </div>
  </ng-container>
</p-dialog>

