<!-- âœ… Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
<div
  class="toolbar d-flex flex-wrap justify-content-end gap-3 position-relative mt-2"
>
  <div class="position-relative">
    <button class="btn btn-outline-warning" (click)="toggleRegisterForm()">
      â• ØªØ³Ø¬ÙŠÙ„ Ø¹Ø±Ø¨ÙŠØ© Ø¬Ø¯ÙŠØ¯Ø©
    </button>
    <div class="arrow-wrapper" *ngIf="showRegisterForm">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>
</div>

<!-- âœ… ÙÙˆØ±Ù… ØªØ³Ø¬ÙŠÙ„ / ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
<div class="table-container mt-0" *ngIf="showRegisterForm" dir="rtl">
  <app-car-register
    *ngIf="showRegisterForm"
    [car]="selectedCar"
    (closeForm)="toggleRegisterForm()"
    [isEditMode]="isEditMode"
  ></app-car-register>
</div>

<!-- âœ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
<div class="car-wrap" *ngIf="!showRegisterForm">
  <div class="cards-grid" dir="rtl">
    <div
      class="card car-card"
      *ngFor="let car of cars; trackBy: trackById"
      (click)="viewCar(car)"
      role="button"
      aria-label="Open car {{ car.Brand.BrandName }} {{ car.Model }}"
    >
      <!-- ØµÙˆØ±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <div class="card-media">
        <img
          [src]="car.Images.length ? car.Images[0].Img : defaultCarImage"
          alt="{{ car.Brand.BrandName }}"
          loading="lazy"
        />
      </div>

      <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <span
        class="status-badge"
        [ngClass]="{ online: car.IsForSale, offline: !car.IsForSale }"
      >
        {{ car.IsForSale ? "Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø¨ÙŠØ¹" : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©" }}
      </span>

      <div class="card-body text-center">

        <!-- Ø´Ø¹Ø§Ø± Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯ -->
        <div class="brand-logo-wrapper mb-2">
          <img
            [src]="car.Brand.Img || defaultCarImage"
            alt="{{ car.Brand.BrandName }}"
            class="brand-logo rounded-circle"
            width="50"
            height="50"
          />
        </div>

        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
        <h3 class="car-model">{{ car.Model }}</h3>

        <p class="car-info mb-1">
          Ø§Ù„Ù†ÙˆØ¹: {{ car.Type }} | Ø§Ù„Ù„ÙˆÙ†: {{ car.Color }}
        </p>

        <!-- Ø¹Ø±Ø¶ Ø¹Ù„Ù… Ø§Ù„Ø¯ÙˆÙ„Ø© -->
        <p class="car-country d-flex align-items-center justify-content-center gap-1 mb-1">
          <img
            [src]="car.Brand.Country.Img || defaultCarImage"
            alt="{{ car.Brand.Country.CountryName }}"
            class="country-flag rounded-circle"
            width="50"
            height="50"
          />
          {{ car.Brand.Country.CountryName }}
        </p>

        <p class="car-year mb-1">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹: {{ car.YearOfManufacture }}</p>
        <p class="car-km mb-1">Ø§Ù„ÙƒÙŠÙ„Ùˆ Ù…ØªØ±: {{ car.Kilometers }}</p>

        <!-- Ø§Ù„Ø³Ø¹Ø± -->
        <p class="car-price fw-bold text-primary mb-2">
          Ø§Ù„Ø³Ø¹Ø±: {{ car.Price | currency : "EGP" }}
        </p>

        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
        <div class="card-actions d-flex justify-content-center gap-2 mt-2">
          <button
            class="btn btn-sm btn-success rounded-circle"
            (click)="editCar(car); $event.stopPropagation()"
          >
            âœï¸
          </button>
          <button
            class="btn btn-sm btn-danger rounded-circle"
            (click)="deleteCar(car); $event.stopPropagation()"
          >
            ğŸ—‘
          </button>
        </div>

      </div>
    </div>
  


<!-- âœ… Dialog Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ø¹ Carousel -->
<p-dialog
  header="ğŸš— Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©"
  [(visible)]="showCarDialog"
  [modal]="true"
  [closable]="true"
  [style]="{ width: '500px' }"
  [baseZIndex]="10000"
  dir="rtl"
>
  <ng-container *ngIf="selectedCar">
    <div class="text-center p-2">

      <!-- âœ… Carousel Ù„Ù„ØµÙˆØ± -->
      <p-carousel 
        [value]="selectedCar.Images.length ? selectedCar.Images : [defaultCarImage]"
        [numVisible]="1" 
        [numScroll]="1"
        [circular]="true"
        [autoplayInterval]="3000"
        [showIndicators]="true"
        [showNavigators]="true"
      >
        <ng-template pTemplate="item" let-image>
          <img 
            [src]="image.Img ? image.Img : image" 
            class="rounded mb-3"
            width="200"
            height="150"
            alt="Car image"
          />
        </ng-template>
      </p-carousel>

      <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
      <h4>{{ selectedCar.Brand.BrandName }} - {{ selectedCar.Model }}</h4>
      <p>{{ selectedCar.Type }} | {{ selectedCar.Color }}</p>

      <hr />

      <p><strong>ğŸ­ Ø§Ù„ÙØ±Ø¹ / Ø§Ù„Ø¨Ù„Ø¯:</strong> {{ selectedCar.Brand.BrandName }} - {{ selectedCar.Brand.Country.CountryName }}</p>
      <p><strong>ğŸ“… Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹:</strong> {{ selectedCar.YearOfManufacture }}</p>
      <p><strong>ğŸ›£ Ø§Ù„ÙƒÙŠÙ„Ùˆ Ù…ØªØ±:</strong> {{ selectedCar.Kilometers }}</p>
      <p><strong>ğŸ’° Ø§Ù„Ø³Ø¹Ø±:</strong> {{ selectedCar.Price | currency : "EGP" }}</p>
      <p><strong>ğŸ“¡ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> {{ selectedCar.IsForSale ? "Ù…Ø¹Ø±ÙˆØ¶Ø© Ù„Ù„Ø¨ÙŠØ¹" : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆØ¶Ø©" }}</p>

    </div>
  </ng-container>
</p-dialog>

