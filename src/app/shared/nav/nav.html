<!-- โ ุดุฑูุท ุงูุฃุฒุฑุงุฑ -->
<div
  class="toolbar d-flex flex-wrap justify-content-end gap-3 position-relative"
>
  <div class="position-relative">
    <button class="btn btn-outline-warning" (click)="toggleTable('car')">
      โ ุฅุถุงูุฉ ุณูุงุฑุฉ
    </button>
    <div class="arrow-wrapper" *ngIf="activeTable === 'car'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>

  <div class="position-relative">
    <button class="btn btn-outline-success" (click)="toggleTable('brand')">
      โ ุฅุถุงูุฉ ุจุฑุงูุฏ
    </button>
    <!-- โฌ๏ธ ุงูุณูู ุชุญุช ุงูุฒุฑ -->
    <div class="arrow-wrapper" *ngIf="activeTable === 'brand'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>

  <div class="position-relative">
    <button class="btn btn-outline-primary" (click)="toggleTable('country')">
      โ ุฅุถุงูุฉ ุจูุฏ
    </button>

    <div class="arrow-wrapper" *ngIf="activeTable === 'country'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>
</div>

<!-- โ ุฌุฏูู ุงูุฏูู -->
<div class="table-container mt-3" *ngIf="activeTable === 'country'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงูุจูุฏ</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <!-- โ ุงูุตููู ุงูุนุงุฏูุฉ ูุน ุชุนุฏูู inline -->
      <tr *ngFor="let country of countries; let i = index">
        <td>{{ i + 1 }}</td>

        <!-- ุงูุงุณู ุฃู input ููุชุนุฏูู -->
        <td *ngIf="editingCountryIndex !== i">{{ country.name }}</td>
        <td *ngIf="editingCountryIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newCountry"
          />
        </td>

        <!-- ุงูุฅุฌุฑุงุกุงุช -->
        <td>
          <!-- ุฃุฒุฑุงุฑ ุชุนุฏูู ูุญุฐู ุนุงุฏูุฉ -->
          <ng-container *ngIf="editingCountryIndex !== i">
            <button
              class="btn btn-sm btn-success mx-1"
              (click)="editCountry(i)"
            >
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteCountry(i)">
              ๐ ุญุฐู
            </button>
            <!-- <button
              class="btn btn-sm btn-primary mx-1"
              (click)="chooseCountry(country.id)"
            >
              โ ุงุฎุชุฑ ุงูุฏููุฉ
            </button> -->
          </ng-container>

          <!-- ุฃุฒุฑุงุฑ ุญูุธ/ุฅูุบุงุก ููุชุนุฏูู -->
          <ng-container *ngIf="editingCountryIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveCountry()">
              โ๏ธ ุญูุธ
            </button>
            <button class="btn btn-sm btn-secondary mx-1" (click)="cancelAdd()">
              โ ุฅูุบุงุก
            </button>
            <!-- <button
              class="btn btn-sm btn-primary mx-1"
              (click)="chooseCountry(country.id!)"
            >
              โ ุงุฎุชุฑ ุงูุฏููุฉ
            </button> -->
          </ng-container>
        </td>
      </tr>

      <!-- โ๏ธ ุตู ุงูุฅุฏุฎุงู ูุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ -->
      <tr *ngIf="addingCountry && editingCountryIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            placeholder="ุงูุชุจ ุงุณู ุงูุจูุฏ"
            [(ngModel)]="newCountry"
          />
        </td>
        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveCountry()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelAdd()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>

      <!-- ๐ ุฒุฑ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ -->
      <tr *ngIf="!addingCountry && editingCountryIndex === null">
        <td colspan="3" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAdd()">
            โ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏุฉ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- โ ุฌุฏูู ุงูุณูุงุฑุงุช -->
<div class="table-container mt-3" *ngIf="activeTable === 'car'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงูุณูุงุฑุฉ</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let car of cars; let i = index">
        <td>{{ i + 1 }}</td>
        <td *ngIf="editingCarIndex !== i">{{ car.name }}</td>
        <td *ngIf="editingCarIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newCar"
          />
        </td>
        <td>
          <ng-container *ngIf="editingCarIndex !== i">
            <button class="btn btn-sm btn-success mx-1" (click)="editCar(i)">
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteCar(i)">
              ๐ ุญุฐู
            </button>
          </ng-container>
          <ng-container *ngIf="editingCarIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveCar()">
              โ๏ธ ุญูุธ
            </button>
            <button class="btn btn-sm btn-secondary mx-1" (click)="cancelCar()">
              โ ุฅูุบุงุก
            </button>
          </ng-container>
        </td>
      </tr>
      <tr *ngIf="addingCar && editingCarIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newCar"
            placeholder="ุงูุชุจ ุงุณู ุงูุณูุงุฑุฉ"
          />
        </td>
        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveCar()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelCar()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>
      <tr *ngIf="!addingCar && editingCarIndex === null">
        <td colspan="3" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAddCar()">
            โ ุฅุถุงูุฉ ุณูุงุฑุฉ ุฌุฏูุฏุฉ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- โ ุฌุฏูู ุงูุจุฑุงูุฏ -->
<div class="table-container mt-3" *ngIf="activeTable === 'brand'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงูุจุฑุงูุฏ</th>
        <th>ุงุณู ุงูุฏููุฉ ุงูุชุงุจุน ููุง</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let brand of brands; let i = index">
        <td>{{ i + 1 }}</td>

        <!-- ๐ ูู ูู ุชุนุฏูู ูุธูุฑ input -->
        <td *ngIf="editingBrandIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBrand"
          />
        </td>
        <td *ngIf="editingBrandIndex !== i">
          {{ brand?.BrandName || "-" }}
        </td>

        <!-- ๐ ุงูุฏููุฉ -->
        <td *ngIf="editingBrandIndex !== i">
          {{ countryMap[brand.CountryId] || "-" }}
        </td>

        <td *ngIf="editingBrandIndex === i">
          <select class="form-select text-center" [(ngModel)]="brand.CountryId">
            <option [ngValue]="null" disabled>ุงุฎุชุฑ ุงูุฏููุฉ</option>
            <option *ngFor="let country of countries" [ngValue]="country.id">
              {{ country.name }}
            </option>
          </select>
        </td>

        <!-- ๐งฐ ุงูุฅุฌุฑุงุกุงุช -->
        <td>
          <ng-container *ngIf="editingBrandIndex !== i">
            <button class="btn btn-sm btn-success mx-1" (click)="editBrand(i)">
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger mx-1" (click)="deleteBrand(i)">
              ๐ ุญุฐู
            </button>
            <!-- <button
              class="btn btn-sm btn-primary mx-1"
              (click)="chooseBrand(brand.Id)"
            >
              โ ุงุฎุชุฑ ุงูุจุฑุงูุฏ
            </button> -->
          </ng-container>

          <ng-container *ngIf="editingBrandIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveBrand()">
              ๐พ ุญูุธ
            </button>
            <button
              class="btn btn-sm btn-secondary mx-1"
              (click)="cancelBrand()"
            >
              โ ุฅูุบุงุก
            </button>
          </ng-container>
        </td>
      </tr>

      <!-- โ ุตู ุงูุฅุถุงูุฉ -->
      <tr *ngIf="addingBrand && editingBrandIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBrand"
            placeholder="ุงูุชุจ ุงุณู ุงูุจุฑุงูุฏ"
          />
        </td>
        <!-- ๐ ุงูุฏููุฉ -->
        <td>
          <select
            class="form-select text-center"
            [(ngModel)]="newBrandCountryId"
          >
            <option [ngValue]="null" disabled>ุงุฎุชุฑ ุงูุฏููุฉ</option>
            <option *ngFor="let country of countries" [ngValue]="country.id">
              {{ country.name }}
            </option>
          </select>
        </td>

        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveBrand()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelBrand()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>

      <!-- ๐น ุฒุฑุงุฑ ุงูุฅุถุงูุฉ -->
      <tr *ngIf="!addingBrand && editingBrandIndex === null">
        <td colspan="4" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAddBrand()">
            โ ุฅุถุงูุฉ ุจุฑุงูุฏ ุฌุฏูุฏุฉ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
