<!-- โ ุดุฑูุท ุงูุฃุฒุฑุงุฑ -->
<div
  class="toolbar d-flex flex-wrap justify-content-end gap-3 position-relative"
>
  <div class="position-relative">
    <button class="btn btn-outline-warning" (click)="toggleTable('branch')">
      โ ุฅุถุงูุฉ ูุฑุน
    </button>
    <div class="arrow-wrapper" *ngIf="activeTable === 'branch'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>

  <div class="position-relative">
    <button class="btn btn-outline-success" (click)="toggleTable('brand')">
      โ ุฅุถุงูุฉ ุจุฑุงูุฏ
    </button>
    <!-- โฌ๏ธ ุงูุณูู ุชุญุช ุงูุฒุฑ -->
    <div class="arrow-wrapper" *ngIf="activeTable === 'brand'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>

  <div class="position-relative">
    <button class="btn btn-outline-primary" (click)="toggleTable('country')">
      โ ุฅุถุงูุฉ ุจูุฏ
    </button>

    <div class="arrow-wrapper" *ngIf="activeTable === 'country'">
      <i class="bi bi-caret-down-fill arrow-icon"></i>
    </div>
  </div>
</div>

<!-- โ ุฌุฏูู ุงูุฏูู -->
<div class="table-container mt-3" *ngIf="activeTable === 'country'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงูุจูุฏ</th>
        <th>ุตูุฑุฉ ุงูุจูุฏ</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <!-- โ ุงูุตููู ุงูุนุงุฏูุฉ ูุน ุชุนุฏูู inline -->
      <tr *ngFor="let country of countries; let i = index">
        <td>{{ i + 1 }}</td>

        <!-- ุงูุงุณู ุฃู input ููุชุนุฏูู -->
        <td *ngIf="editingCountryIndex !== i">{{ country.name }}</td>
        <td *ngIf="editingCountryIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newCountry"
          />
        </td>
        <!-- ๐ผ๏ธ ุงูุตูุฑุฉ -->
        <td *ngIf="editingCountryIndex !== i">
          <!-- ูู ูููุด ุตูุฑุฉ ุฌุฏูุฏุฉุ ูุธูุฑ ุงููุฏููุฉ ุฃู ุงูุฃููููุฉ -->
          <ng-container *ngIf="country.img; else noImage">
            <img
              [src]="country.img"
              alt="ุตูุฑุฉ"
              width="50"
              height="50"
              class="rounded border border-dark"
              style="object-fit: cover"
            />
          </ng-container>
          <ng-template #noImage>
            <i class="bi bi-image fs-3 text-secondary"></i>
          </ng-template>
        </td>

        <td *ngIf="editingCountryIndex === i">
          <input type="file" (change)="onCountryImageSelected($event)" />
        </td>

        <!-- ุงูุฅุฌุฑุงุกุงุช -->
        <td>
          <!-- ุฃุฒุฑุงุฑ ุชุนุฏูู ูุญุฐู ุนุงุฏูุฉ -->
          <ng-container *ngIf="editingCountryIndex !== i">
            <button
              class="btn btn-sm btn-success mx-1"
              (click)="editCountry(i)"
            >
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteCountry(i)">
              ๐ ุญุฐู
            </button>
            <!-- <button
              class="btn btn-sm btn-primary mx-1"
              (click)="chooseCountry(country.id)"
            >
              โ ุงุฎุชุฑ ุงูุฏููุฉ
            </button> -->
          </ng-container>

          <!-- ุฃุฒุฑุงุฑ ุญูุธ/ุฅูุบุงุก ููุชุนุฏูู -->
          <ng-container *ngIf="editingCountryIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveCountry()">
              โ๏ธ ุญูุธ
            </button>
            <button class="btn btn-sm btn-secondary mx-1" (click)="cancelAdd()">
              โ ุฅูุบุงุก
            </button>
            <!-- <button
              class="btn btn-sm btn-primary mx-1"
              (click)="chooseCountry(country.id!)"
            >
              โ ุงุฎุชุฑ ุงูุฏููุฉ
            </button> -->
          </ng-container>
        </td>
      </tr>

      <!-- โ๏ธ ุตู ุงูุฅุฏุฎุงู ูุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ -->
      <tr *ngIf="addingCountry && editingCountryIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            placeholder="ุงูุชุจ ุงุณู ุงูุจูุฏ"
            [(ngModel)]="newCountry"
          />
        </td>
        <td>
          <input type="file" (change)="onCountryImageSelected($event)" />
          <div class="mt-2" *ngIf="countryPreview">
            <img
              [src]="countryPreview"
              alt="ุตูุฑุฉ ุงูุจูุฏ"
              width="50"
              height="50"
              class="rounded border border-dark"
              style="object-fit: cover"
            />
          </div>
        </td>

        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveCountry()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelAdd()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>

      <!-- ๐ ุฒุฑ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏ -->
      <tr *ngIf="!addingCountry && editingCountryIndex === null">
        <td colspan="4" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAdd()">
            โ ุฅุถุงูุฉ ุจูุฏ ุฌุฏูุฏุฉ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- โ ุฌุฏูู ุงููุฑูุน -->
<div class="table-container mt-3" *ngIf="activeTable === 'branch'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงููุฑุน</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let branch of branchs; let i = index">
        <td>{{ i + 1 }}</td>
        <td *ngIf="editingBranchIndex !== i">{{ branch.BranchName }}</td>
        <td *ngIf="editingBranchIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBranch"
          />
        </td>
        <td>
          <ng-container *ngIf="editingBranchIndex !== i">
            <button class="btn btn-sm btn-success mx-1" (click)="editBranch(i)">
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteBranch(i)">
              ๐ ุญุฐู
            </button>
          </ng-container>
          <ng-container *ngIf="editingBranchIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveBranch()">
              โ๏ธ ุญูุธ
            </button>
            <button class="btn btn-sm btn-secondary mx-1" (click)="cancelBranch()">
              โ ุฅูุบุงุก
            </button>
          </ng-container>
        </td>
      </tr>
      <tr *ngIf="addingBranch && editingBranchIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBranch"
            placeholder="ุงูุชุจ ุงุณู ุงููุฑุน"
          />
        </td>
        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveBranch()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelBranch()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>
      <tr *ngIf="!addingBranch && editingBranchIndex === null">
        <td colspan="3" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAddBranch()">
            โ ุฅุถุงูุฉ ูุฑุน ุฌุฏูุฏ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- โ ุฌุฏูู ุงูุจุฑุงูุฏ -->
<div class="table-container mt-3" *ngIf="activeTable === 'brand'" dir="rtl">
  <table class="table table-bordered text-center align-middle">
    <thead class="table-light">
      <tr>
        <th>#</th>
        <th>ุงุณู ุงูุจุฑุงูุฏ</th>
        <th>ุตูุฑุฉ ุงูุจุฑุงูุฏ</th>
        <th>ุงุณู ุงูุฏููุฉ ุงูุชุงุจุน ููุง</th>
        <th>ุงูุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let brand of brands; let i = index">
        <!-- # -->
        <td>{{ i + 1 }}</td>

        <!-- ๐ ุงุณู ุงูุจุฑุงูุฏ -->
        <td *ngIf="editingBrandIndex === i">
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBrand"
          />
        </td>
        <td *ngIf="editingBrandIndex !== i">
          {{ brand?.BrandName || "-" }}
        </td>

        <!-- ๐ผ๏ธ ุตูุฑุฉ ุงูุจุฑุงูุฏ -->
        <td *ngIf="editingBrandIndex !== i">
          <ng-container *ngIf="brand.Img; else noImage">
            <img
              [src]="brand.Img"
              alt="ุตูุฑุฉ"
              width="50"
              height="50"
              class="rounded border border-dark"
              style="object-fit: cover"
            />
          </ng-container>
          <ng-template #noImage>
            <i class="bi bi-image fs-3 text-secondary"></i>
          </ng-template>
        </td>
        <td *ngIf="editingBrandIndex === i">
          <input type="file" (change)="onBrandImageSelected($event)" />
          <!-- ูู ูู ุตูุฑุฉ ุฌุฏูุฏุฉ -->
          <div *ngIf="brandPreview" class="mt-2">
            <img
              [src]="brandPreview"
              width="50"
              height="50"
              class="rounded border border-dark"
              style="object-fit: cover"
            />
          </div>
        </td>

        <!-- ๐ ุงูุฏููุฉ -->
        <td *ngIf="editingBrandIndex !== i">
          {{ countryMap[brand.CountryId] || "-" }}
        </td>
        <td *ngIf="editingBrandIndex === i">
          <select class="form-select text-center" [(ngModel)]="brand.CountryId">
            <option [ngValue]="null" disabled>ุงุฎุชุฑ ุงูุฏููุฉ</option>
            <option *ngFor="let country of countries" [ngValue]="country.id">
              {{ country.name }}
            </option>
          </select>
        </td>

        <!-- ๐งฐ ุงูุฅุฌุฑุงุกุงุช -->
        <td>
          <ng-container *ngIf="editingBrandIndex !== i">
            <button class="btn btn-sm btn-success mx-1" (click)="editBrand(i)">
              โ๏ธ ุชุนุฏูู
            </button>
            <button class="btn btn-sm btn-danger mx-1" (click)="deleteBrand(i)">
              ๐ ุญุฐู
            </button>
          </ng-container>

          <ng-container *ngIf="editingBrandIndex === i">
            <button class="btn btn-sm btn-success mx-1" (click)="saveBrand()">
              ๐พ ุญูุธ
            </button>
            <button
              class="btn btn-sm btn-secondary mx-1"
              (click)="cancelBrand()"
            >
              โ ุฅูุบุงุก
            </button>
          </ng-container>
        </td>
      </tr>

      <!-- โ ุตู ุงูุฅุถุงูุฉ -->
      <tr *ngIf="addingBrand && editingBrandIndex === null">
        <td>+</td>
        <td>
          <input
            type="text"
            class="form-control text-center"
            [(ngModel)]="newBrand"
            placeholder="ุงูุชุจ ุงุณู ุงูุจุฑุงูุฏ"
          />
        </td>
        <td>
          <input type="file" (change)="onBrandImageSelected($event)" />
          <div *ngIf="brandPreview" class="mt-2">
            <img
              [src]="brandPreview"
              width="50"
              height="50"
              class="rounded border border-dark"
              style="object-fit: cover"
            />
          </div>
        </td>
        <td>
          <select
            class="form-select text-center"
            [(ngModel)]="newBrandCountryId"
          >
            <option [ngValue]="null" disabled>ุงุฎุชุฑ ุงูุฏููุฉ</option>
            <option *ngFor="let country of countries" [ngValue]="country.id">
              {{ country.name }}
            </option>
          </select>
        </td>
        <td>
          <button class="btn btn-sm btn-success mx-1" (click)="saveBrand()">
            โ๏ธ ุญูุธ
          </button>
          <button class="btn btn-sm btn-secondary mx-1" (click)="cancelBrand()">
            โ ุฅูุบุงุก
          </button>
        </td>
      </tr>

      <!-- ๐น ุฒุฑุงุฑ ุงูุฅุถุงูุฉ -->
      <tr *ngIf="!addingBrand && editingBrandIndex === null">
        <td colspan="5" class="text-center">
          <button class="btn btn-sm btn-primary" (click)="startAddBrand()">
            โ ุฅุถุงูุฉ ุจุฑุงูุฏ ุฌุฏูุฏ
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
